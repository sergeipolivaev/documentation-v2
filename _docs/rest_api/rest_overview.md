---
title: Что такое API Облака Эвотор?
permalink: rest_overview.html
sidebar: evorest
product:
---

API Облака Эвотор это RESTful интерфейс, который позволяет интегрировать сторонние веб-сервисы с Платформой Эвотор.

К типичному сценарию использования API Облака относится работа с данными пользователей смарт-терминалов: магазинами, товарами, документами смарт-терминала, сотрудниками пользователей.

## Корневой адрес, типы данных и версия API

Все запросы к API Облака Эвотор выполняются на корневой адрес:

```
https://api.evotor.ru
```

Тип содержимого запроса указывайте в заголовке `Content-Type` следующим образом:

```
Content-Type: application/vnd.evotor.v2+json
```

Если вам необходимо выполнять [массовые операции](./rest_overview.html#bulk), вы можете дополнить заголовок модификатором `+bulk`:

```
Content-Type: application/vnd.evotor.v2+bulk+json
```

Методы [передачи изображений](./rest_images.html) поддерживают специальный тип данных:

```
Content-Type: multipart/form-data
```

Версию API Облака, к которой выполняется запрос, следует явно указывать в заголовке `Accept`:

```
Accept: application/vnd.evotor.v2+json
```

{% include note.html content="По умолчанию, все запросы выполняются ко второй (`v2`) версии API Облака." %}

## Авторизация и аутентификация

Запросы к REST API Облака Эвотор авторизуются с помощью пользовательского Bearer-токена. Передавайте его в заголовке `Authorization`.

Получить токен можно одним из способов, описанных [здесь](./doc_authorization.html).

Токен однозначно идентифицирует пользователя и приложение, а также определяет перечень доступных ресурсов и допустимых операций над ними.

## Коды состояния

Код  | Сообщение  | Описание
-----|------------|---------
`200`| OK         |  Выполнение **синхронной** операции удачно и конечно. __`::TODO::`__ В теле ответа можно вернуть состояние ресурса.
`201`| Accepted   |  Если выполнение **синхронной** операции удачно и конечно, а реализация не хочет ничего возвращать в ответе, - в теле ответа должен присутствовать заголовок `Location`. Если делался запрос на операцию с одним элементом - то в ответе должен присутствовать заголовок `Location` со ссылкой на этот элемент: `/resources/:resource-id`. Если запрос выполнялся на коллекцию, то `Location`: `/resources`.
`202`| Accepted   |  Асинхронное выполнение операции. В ответе должен присутствовать заголовок `Location` со значением `/resource-tasks/:task-id`.
`204`| Успешно    |  Ресурс удалён успешно.
`401`| no access  |  
`403`| no access  |  Нет доступа. Ошибка возникает когда у приложения нет разрешения на запрашиваемое действие или пользователь не установил приложение в Личном кабинете.
`404`| not found  |  
`413`| Payload Too Large    |  
`429`| Rate Limit Exceeded    |  

## Пагинация

Некоторые запросы, например, получение списка товаров или документов, возвращают массивы данных `items`. По умолчанию, такие запросы возвращают 1000 элементов. Вы можете ограничить выдачу запроса, с помощью необязательного параметра `limit`.

```shell
GET https://api.evotor.ru/stores/{store-id}/documents?limit=50
```

Также, ответы на такие запросы содержат объект `paging`.

```json
{
  "items": [{}],
  "paging": {
    "next_cursor": "string"
  }
}
```

В этом объекте передаётся поле `next_cursor`, с помощью которого вы сможете получить остальные данные. Для этого, значение поля необходимо передать в качестве параметра запроса:

```shell
GET https://api.evotor.ru/stores/{store-id}/documents?next_cursor=string
```

Если ответ на запрос содержит все доступные данные, объект `paging` будет пустым.

Следующие методы поддерживают пагинацию:

* [Получение списка магазинов](./rest_stores.html#Получить-список-магазинов)
* [Получение списка смарт-терминалов](./rest_smart_terminals.html#Получить-список-смарт-терминалов)
* [Получение списка сотрудников](./rest_employees.html#Получить-список-сотрудников)
* [Получение всех документов](./rest_documents.html#Получить-список-документов)
* [Получение документов по идентификатору смарт-терминала](./rest_documents.html#Получить-список-документов-по-идентификатору-смарт-терминала)
* [Получение всех товаров](./rest_products.html#Получить-все-товары)
* [Получение всех групп товаров](./rest_products_groups.html#Получить-все-группы)
* [Получение статуса задач множественных операций](./rest_bulk_tasks.html#Получить-информацию-о-состоянии-задач)


## Ограничение количества запросов

Облако Эвотор контролирует количество обращений к REST API со стороны клиентов API. Количество запросов ограничивается в контексте пользователя. Если ресурс, к которому осуществляется доступ, имеет контекст магазина - разрезом для контроля оставшегося лимита выступает также идентификатор магазина.

В процессе функционирования данного механизма, к ответам от Облака Эвотор добавляются следующие заголовки:

* `X-RateLimit-Limit` – максимальное количество запросов, которые клиент API может сделать за временной интервал;
* `X-RateLimit-Remaining` – количество запросов, оставшихся в текущем временном интервале;
* `X-RateLimit-Reset` – время, в секундах, оставшееся до начала нового временного интервала.
Размер временного интервала для каждого ресурса определяется индивидуально и задается на стороне Эвотор.

Каждый выполняемый запрос сокращает остаток лимита (`X-RateLimit-Remaining`).

При превышении доступного лимита, запрос будет отклонен со статусом `429` `Rate Limit Exceeded.`

Чтобы запрос был успешно выполнен после превышения лимита, - необходимо дождаться наступления нового временного интервала.

## Работа с `null`
При работе с REST API Эвотор передача `null` неприемлема. Это правило распространяется как на данные передаваемые клиентами API, так и на данные производимые Облаком Эвотор.

Иными словами, если какое-то из свойств сущности может быть не задано (является опциональным), то его **не нужно** указывать в схеме данных.

## Объем данных в запросе
Максимальный объем данных, который может быть передан в Облако в рамках одного запроса - 10 МБ. В случае превышения допустимого размера тела, запрос будет отклонен со статусом `413 Payload Too Large`.

## Массовые операции {#bulk}
Для массового импорта данных в Облако Эвотор в REST API предусмотрены ресурсы, которые позволяют создать или изменить до 1000 элементов за раз.

Для выполнения массовых операций заголовок `Content-Type` необходимо дополнить модификатором `+bulk`:

```
Content-Type: application/vnd.evotor.v2+bulk+json
```

С помощью методов API Облака вы можете [отслеживать состояние массовых операций](./rest_bulk_tasks.html).

{% include note.html content="Массовые операции предназначены для импорта данных в момент первичной синхронизации (при инициализации облачной интеграции). Для обеспечения консистентности данных Облака Эвотор и внешней системы используйте одиночные запросы." %}

## Фильтрация доступных данных
Клиент API получает только те данные, к которым у него есть доступ.

В зависимости от настроек приложения в личном кабинете пользователя и настроек приложения, которые задал разработчик, - данные в API могут быть отфильтрованы.

Например, при запросе документов продажи за интервал дат из определенного магазина, информация в ответе будет представлена только для тех смарт-терминалов, на которые в момент выполнения запроса установлено приложение.

Аналогично и для запроса списка смарт-терминалов: в ответе будет или не будет содержаться информация об IMEI смарт-терминалов, в зависимости от настроек приложения заданных разработчиком.
